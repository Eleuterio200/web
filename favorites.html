<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Favoritos - Dulce Sabor</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --secondary: #9f1239;
            --light: #fff1f2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: rgba(254, 202, 202, 0.95);
            padding: 18px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid white;
        }

        .logo-icon i {
            font-size: 32px;
            color: #9f1239;
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 38px;
            background: linear-gradient(90deg, #9f1239, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        nav a {
            color: var(--secondary);
            text-decoration: none;
            margin: 0 18px;
            font-weight: 600;
        }

        .page-header {
            text-align: center;
            padding: 80px 20px 40px;
            background: linear-gradient(to bottom, #fecaca, #fff1f2);
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: 58px;
            background: linear-gradient(90deg, #ec4899, #db2777);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .favorite-card {
            background: white;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            transition: 0.4s;
        }

        .favorite-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 30px 70px rgba(236, 72, 153, 0.3);
        }

        .favorite-card img {
            width: 100%;
            height: 260px;
            object-fit: cover;
        }

        .favorite-info {
            padding: 25px;
            text-align: center;
        }

        .favorite-info h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 22px;
        }

        .price {
            font-size: 28px;
            color: var(--primary);
            font-weight: 700;
        }

        .btn-view {
            margin-top: 15px;
            padding: 12px 30px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 100px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 80px;
            color: #ec4899;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <header>
        <div class="container">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-birthday-cake"></i></div>
                <h1>Dulce Sabor</h1>
            </div>
            <nav>
                <a href="catalog.html">Catálogo</a>
                <a href="orders.html">Mis Pedidos</a>
                <a href="favorites.html"><i class="fas fa-heart"></i> Favoritos</a>
            </nav>
        </div>
    </header>

    <div class="page-header">
        <h2 class="page-title">Mis Favoritos</h2>
    </div>

    <div id="favoritesContainer" class="favorites-grid">
        <div class="empty-state">
            <i class="far fa-heart"></i>
            <h3>No tienes favoritos aún</h3>
            <p>Explora el catálogo y toca <i class="fas fa-heart" style="color:var(--primary)"></i> para guardarlos aquí
            </p>
            <a href="catalog.html"
                style="margin-top:20px; padding:14px 32px; background:var(--primary); color:white; border-radius:50px; text-decoration:none;">Ir
                al Catálogo</a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyCcP-o0ptLQM5vOOB0O0Z8hZH_KFv3Uvm8", authDomain: "pasteleria-e3386.firebaseapp.com", projectId: "pasteleria-e3386", storageBucket: "pasteleria-e3386.firebasestorage.app", messagingSenderId: "365968659983", appId: "1:365968659983:web:2d904933f8f7a91094f57a" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const container = document.getElementById('favoritesContainer');

        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                container.innerHTML = `<div class="empty-state">
                    <i class="fas fa-user-lock"></i>
                    <h3>Inicia sesión para ver tus favoritos</h3>
                    <a href="auth.html" style="margin-top:20px; padding:14px 32px; background:var(--primary); color:white; border-radius:50px; text-decoration:none;">Iniciar Sesión</a>
                </div>`;
                return;
            }

            loadFavorites(user.uid);
        });

        async function loadFavorites(uid) {
            container.innerHTML = `<div style="text-align:center; padding:100px;"><i class="fas fa-spinner fa-spin" style="font-size:60px; color:#ec4899;"></i></div>`;

            try {
                const snapshot = await db.collection('favorites').doc(uid).collection('items').orderBy('addedAt', 'desc').get();

                if (snapshot.empty) {
                    container.innerHTML = `<div class="empty-state">
                        <i class="far fa-heart"></i>
                        <h3>No tienes favoritos aún</h3>
                        <p>¡Guarda tus pasteles favoritos tocando el corazón!</p>
                        <a href="catalog.html" style="margin-top:20px; padding:14px 32px; background:var(--primary); color:white; border-radius:50px; text-decoration:none;">Explorar Catálogo</a>
                    </div>`;
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const fav = doc.data();
                    const card = document.createElement('div');
                    card.className = 'favorite-card';
                    card.onclick = () => window.location.href = `product.html?id=${fav.productId}`;
                    card.innerHTML = `
                        <img src="${fav.image}" alt="${fav.name}">
                        <div class="favorite-info">
                            <h3>${fav.name}</h3>
                            <div class="price">Desde $${Number(fav.price).toFixed(2)}</div>
                            <button class="btn-view">Ver Detalle</button>
                        </div>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Error al cargar</h3></div>`;
            }
        }
    </script>
</body>

</html>